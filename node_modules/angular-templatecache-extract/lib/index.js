'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _esquery = require('esquery');

var _esquery2 = _interopRequireDefault(_esquery);

var _esprima = require('esprima');

var _esprima2 = _interopRequireDefault(_esprima);

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _staticEval = require('static-eval');

var _staticEval2 = _interopRequireDefault(_staticEval);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = function (js) {
  return new _bluebird2.default(function (resolve) {
    var result = [];
    var content = _esprima2.default.parse(js);
    var tree = (0, _esquery2.default)(content, 'CallExpression[callee.object.name="$templateCache"]' + '[callee.object.type="Identifier"]' + '[callee.property.name="put"]' + '[callee.property.type="Identifier"]');
    _bluebird2.default.map(tree, function (elem) {
      if (elem.arguments && elem.arguments[1]) {
        var ev = (0, _staticEval2.default)(elem.arguments[1]);
        if (ev) {
          result.push(ev);
        }
      }
      return _bluebird2.default.resolve();
    }).then(function () {
      resolve(result);
    });
  });
};

module.exports = exports['default'];